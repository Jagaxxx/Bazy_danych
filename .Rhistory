#| echo: false
#| warning: false
library(dplyr)
library(DBI)
library(tidyr)
library(scales)
#| echo: false
#| warning: false
library(dplyr)
library(DBI)
library(tidyr)
library(scales)
#| echo: false
#| warning: false
library(RMariaDB)
library(ggplot2)
#połączenie z bazą danych
con <- dbConnect(RMariaDB::MariaDB(),
dbname = "team12",
username = "team12",
password = "te@mliz",
host = "giniewicz.it")
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 14. Heatmapa wspólnych wyjazdów wybranych członków załogi"
query7 <- "SELECT s.id_pilot AS id_pilota, s.id_guide AS id_przewodnika, CONCAT(e1.first_name, ' ', e1.last_name, ', ', e2.first_name, ' ',
e2.last_name) AS imiona, COUNT(*) AS liczba_wyjazdów
FROM spaceflight AS s INNER JOIN employee AS e1 ON s.id_pilot = e1.id_employee
INNER JOIN employee AS e2 ON s.id_guide = e2.id_employee
GROUP BY s.id_pilot, s.id_guide
ORDER BY COUNT(*) DESC"
df7 <- dbGetQuery(con, query7)
df7$liczba_wyjazdów <- as.integer(df7$liczba_wyjazdów)
query7_1 <- "SELECT s.id_pilot AS id_pilota, s.id_guide AS id_przewodnika, CONCAT(e1.first_name, ' ', e1.last_name, ', ', e2.first_name, ' ',
e2.last_name) AS imiona, COUNT(*) AS liczba_wyjazdów
FROM spaceflight AS s INNER JOIN employee AS e1 ON s.id_pilot = e1.id_employee
INNER JOIN employee AS e2 ON s.id_guide = e2.id_employee
GROUP BY s.id_pilot, s.id_guide
ORDER BY COUNT(*) DESC LIMIT 1"
df7_1 <- dbGetQuery(con, query7_1)
ggplot(df7, aes(x = df7$imiona, y = df7$liczba_wyjazdów)) +
geom_col(fill = "lightblue") +
labs(title = "Liczba wspólnych wyjazdów wybranych członków załogi", x = "Załoga", y = "Liczba wyjazdów") +
theme(axis.text.x = element_text(angle = 45, hjust = 1), plot.margin = margin(1, 1, 2, 2, "cm"))
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 14. Heatmapa wspólnych wyjazdów wybranych członków załogi"
query7 <- "SELECT s.id_pilot AS id_pilota, s.id_guide AS id_przewodnika, CONCAT(e1.first_name, ' ', e1.last_name, ', ', e2.first_name, ' ',
e2.last_name) AS imiona, COUNT(*) AS liczba_wyjazdów
FROM spaceflight AS s INNER JOIN employee AS e1 ON s.id_pilot = e1.id_employee
INNER JOIN employee AS e2 ON s.id_guide = e2.id_employee
GROUP BY s.id_pilot, s.id_guide
ORDER BY COUNT(*) DESC"
df7 <- dbGetQuery(con, query7)
df7$liczba_wyjazdów <- as.integer(df7$liczba_wyjazdów)
query7_1 <- "SELECT s.id_pilot AS id_pilota, s.id_guide AS id_przewodnika, CONCAT(e1.first_name, ' ', e1.last_name, ', ', e2.first_name, ' ',
e2.last_name) AS imiona, COUNT(*) AS liczba_wyjazdów
FROM spaceflight AS s INNER JOIN employee AS e1 ON s.id_pilot = e1.id_employee
INNER JOIN employee AS e2 ON s.id_guide = e2.id_employee
GROUP BY s.id_pilot, s.id_guide
ORDER BY COUNT(*) DESC LIMIT 1"
df7_1 <- dbGetQuery(con, query7_1)
crew_query <- "SELECT id_pilot, id_guide FROM spaceflight"
crew_df <- dbGetQuery(con, crew_query)
heatmap
ggplot(df7, aes(x = df7$imiona, y = df7$liczba_wyjazdów)) +
geom_col(fill = "lightblue") +
labs(title = "Liczba wspólnych wyjazdów wybranych członków załogi", x = "Załoga", y = "Liczba wyjazdów") +
theme(axis.text.x = element_text(angle = 45, hjust = 1), plot.margin = margin(1, 1, 2, 2, "cm"))
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 15. Heatmapa wspólnych wyjazdów wybranych członków załogi"
crew_query <- "SELECT id_pilot, id_guide FROM spaceflight"
crew_df <- dbGetQuery(con, crew_query)
colnames(crew_df) <- c("id_pilot", "id_guide", "freq")
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 15. Heatmapa wspólnych wyjazdów wybranych członków załogi"
crew_query <- "SELECT id_pilot, id_guide FROM spaceflight"
crew_df <- dbGetQuery(con, crew_query)
ggplot(crew_df, aes(x = id_pilot, y = id_guide)) +
geom_tile() +
scale_fill_gradient(low = "white", high = "blue") +
theme_minimal()
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 15. Heatmapa wspólnych wyjazdów wybranych członków załogi"
crew_query <- "SELECT id_pilot, id_guide FROM spaceflight"
crew_df <- dbGetQuery(con, crew_query)
ggplot(crew_df, aes(x = id_pilot, y = id_guide, fill = freq)) +
geom_tile() +
scale_fill_gradient(low = "white", high = "blue") +
theme_minimal()
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 15. Heatmapa wspólnych wyjazdów wybranych członków załogi"
crew_query <- "SELECT id_pilot, id_guide FROM spaceflight"
crew_df <- dbGetQuery(con, crew_query)
heatmap(crew_df, col = heat.colors(256), scale = "none")
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 15. Heatmapa wspólnych wyjazdów wybranych członków załogi"
crew_query <- "SELECT id_pilot, id_guide FROM spaceflight"
crew_df <- dbGetQuery(con, crew_query)
heatmap(crew_df)
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 15. Heatmapa wspólnych wyjazdów wybranych członków załogi"
crew_query <- "SELECT id_pilot, id_guide FROM spaceflight"
crew_df <- dbGetQuery(con, crew_query)
crew_heatmap <- df %>%
count(pilot_id, guide_id, name = "flights")
#| echo: false
#| warning: false
library(dplyr)
library(DBI)
library(tidyr)
library(scales)
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 15. Heatmapa wspólnych wyjazdów wybranych członków załogi"
crew_query <- "SELECT id_pilot, id_guide FROM spaceflight"
crew_df <- dbGetQuery(con, crew_query)
crew_heatmap <- df %>%
count(pilot_id, guide_id, name = "flights")
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 15. Heatmapa wspólnych wyjazdów wybranych członków załogi"
crew_query <- "SELECT id_pilot, id_guide FROM spaceflight"
crew_df <- dbGetQuery(con, crew_query)
crew_heatmap <- crew_df %>%
count(pilot_id, guide_id, name = "flights")
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 15. Heatmapa wspólnych wyjazdów wybranych członków załogi"
crew_query <- "SELECT id_pilot, id_guide FROM spaceflight"
crew_df <- dbGetQuery(con, crew_query)
crew_heatmap <- crew_df %>%
count(id_pilot, id_guide, name = "flights")
ggplot(crew_heatmap, aes(x = factor(id_pilot), y = factor(id_guide), fill = flights)) +
geom_tile(color = "white") +
scale_fill_gradient(low = "white", high = "darkblue") +
labs(title = "Liczba wspólnych lotów: Pilot vs Przewodnik",
x = "ID Przewodnika",
y = "ID Pilota",
fill = "Liczba lotów") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 14. Wykres liczby wspólnych wyjazdów wybranych członków załogi"
query7 <- "SELECT s.id_pilot AS id_pilota, s.id_guide AS id_przewodnika, CONCAT(e1.first_name, ' ', e1.last_name, ', ', e2.first_name, ' ',
e2.last_name) AS imiona, COUNT(*) AS liczba_wyjazdów
FROM spaceflight AS s INNER JOIN employee AS e1 ON s.id_pilot = e1.id_employee
INNER JOIN employee AS e2 ON s.id_guide = e2.id_employee
GROUP BY s.id_pilot, s.id_guide
ORDER BY COUNT(*) DESC"
df7 <- dbGetQuery(con, query7)
#| echo: false
#| warning: false
library(dplyr)
library(DBI)
library(tidyr)
library(scales)
#| echo: false
#| warning: false
library(RMariaDB)
library(ggplot2)
#połączenie z bazą danych
con <- dbConnect(RMariaDB::MariaDB(),
dbname = "team12",
username = "team12",
password = "te@mliz",
host = "giniewicz.it")
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 14. Wykres liczby wspólnych wyjazdów wybranych członków załogi"
query7 <- "SELECT s.id_pilot AS id_pilota, s.id_guide AS id_przewodnika, CONCAT(e1.first_name, ' ', e1.last_name, ', ', e2.first_name, ' ',
e2.last_name) AS imiona, COUNT(*) AS liczba_wyjazdów
FROM spaceflight AS s INNER JOIN employee AS e1 ON s.id_pilot = e1.id_employee
INNER JOIN employee AS e2 ON s.id_guide = e2.id_employee
GROUP BY s.id_pilot, s.id_guide
ORDER BY COUNT(*) DESC"
df7 <- dbGetQuery(con, query7)
df7$liczba_wyjazdów <- as.integer(df7$liczba_wyjazdów)
query7_1 <- "SELECT s.id_pilot AS id_pilota, s.id_guide AS id_przewodnika, CONCAT(e1.first_name, ' ', e1.last_name, ', ', e2.first_name, ' ',
e2.last_name) AS imiona, COUNT(*) AS liczba_wyjazdów
FROM spaceflight AS s INNER JOIN employee AS e1 ON s.id_pilot = e1.id_employee
INNER JOIN employee AS e2 ON s.id_guide = e2.id_employee
GROUP BY s.id_pilot, s.id_guide
ORDER BY COUNT(*) DESC LIMIT 1"
df7_1 <- dbGetQuery(con, query7_1)
ggplot(df7, aes(x = df7$imiona, y = df7$liczba_wyjazdów)) +
geom_col(fill = "lightblue") +
labs(title = "Liczba wspólnych wyjazdów wybranych członków załogi", x = "Załoga", y = "Liczba wyjazdów") +
theme(axis.text.x = element_text(angle = 45, hjust = 1), plot.margin = margin(1, 1, 2, 2, "cm"))
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 15. Heatmapa wspólnych wyjazdów wybranych członków załogi"
crew_query <- "SELECT id_pilot, id_guide FROM spaceflight"
crew_df <- dbGetQuery(con, crew_query)
pilot_names_query <- "SELECT CONCAT(first_name, ' ', last_name) FROM employee
WHERE id_employee IN (SELECT DISTINCT id_pilot FROM spaceflight)"
pilot_names_df <- dbGetQuery(con, pilot_names_query)
guide_names_query <- "SELECT CONCAT(first_name, ' ', last_name) FROM employee
WHERE id_employee IN (SELECT DISTINCT id_guide FROM spaceflight)"
guide_names_query <- dbGetQuery(con, guide_names_query)
crew_heatmap <- crew_df %>%
count(id_pilot, id_guide, name = "flights")
ggplot(crew_heatmap, aes(x = factor(id_pilot), y = factor(id_guide), fill = flights)) +
geom_tile(color = "white") +
scale_fill_gradient(low = "white", high = "darkblue") +
labs(title = "Liczba wspólnych lotów: Pilot vs Przewodnik",
x = "ID Przewodnika",
y = "ID Pilota",
fill = "Liczba lotów") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
View(pilot_names_df)
View(pilot_names_df)
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 15. Heatmapa wspólnych wyjazdów wybranych członków załogi"
crew_query <- "SELECT id_pilot, id_guide FROM spaceflight"
crew_df <- dbGetQuery(con, crew_query)
pilot_names_query <- "SELECT CONCAT(first_name, ' ', last_name) FROM employee
WHERE id_employee IN (SELECT DISTINCT id_pilot FROM spaceflight)"
pilot_names_df <- dbGetQuery(con, pilot_names_query)
guide_names_query <- "SELECT CONCAT(first_name, ' ', last_name) FROM employee
WHERE id_employee IN (SELECT DISTINCT id_guide FROM spaceflight)"
guide_names_df <- dbGetQuery(con, guide_names_query)
pilot_names <- factor(pilot_names_df)
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 15. Heatmapa wspólnych wyjazdów wybranych członków załogi"
crew_query <- "WITH pilot_names AS SELECT id_pilot, CONCAT(first_name, ' ', last_name) AS pilot_name FROM employee
WHERE id_employee IN (SELECT DISTINCT id_pilot FROM spaceflight)
WITH guide_names AS SELECT id_guide CONCAT(first_name, ' ', last_name) AS guide_name FROM employee
WHERE id_employee IN (SELECT DISTINCT id_guide FROM spaceflight)
SELECT pilot_names.pilot_name AS pilot, guide_names.guide_name AS guide FROM spaceflight
INNER JOIN pilot_names AS e1 ON spaceflight.id_pilot = pilot_names.id_pilot
INNER JOIN guide_names AS e2 ON spaceflight.id_guide = guide_names.id_guide"
crew_df <- dbGetQuery(con, crew_query)
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 15. Heatmapa wspólnych wyjazdów wybranych członków załogi"
crew_query <- "WITH pilot_names AS SELECT id_employee, CONCAT(first_name, ' ', last_name) AS pilot_name FROM employee
WHERE id_employee IN (SELECT DISTINCT id_pilot FROM spaceflight)
WITH guide_names AS SELECT id_employee, CONCAT(first_name, ' ', last_name) AS guide_name FROM employee
WHERE id_employee IN (SELECT DISTINCT id_guide FROM spaceflight)
SELECT pilot_names.pilot_name AS pilot, guide_names.guide_name AS guide FROM spaceflight
INNER JOIN pilot_names AS e1 ON spaceflight.id_pilot = pilot_names.id_pilot
INNER JOIN guide_names AS e2 ON spaceflight.id_guide = guide_names.id_guide;"
crew_df <- dbGetQuery(con, crew_query)
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 15. Heatmapa wspólnych wyjazdów wybranych członków załogi"
crew_query <- "WITH pilot_names AS (SELECT id_employee, CONCAT(first_name, ' ', last_name) AS pilot_name FROM employee
WHERE id_employee IN (SELECT DISTINCT id_pilot FROM spaceflight)),
guide_names AS (SELECT id_employee, CONCAT(first_name, ' ', last_name) AS guide_name FROM employee
WHERE id_employee IN (SELECT DISTINCT id_guide FROM spaceflight))
SELECT e1.pilot_name AS pilot, e2.guide_name AS guide FROM spaceflight
INNER JOIN pilot_names AS e1 ON spaceflight.id_pilot = e1.id_employee
INNER JOIN guide_names AS e2 ON spaceflight.id_guide = e2.id_employee"
crew_df <- dbGetQuery(con, crew_query)
crew_heatmap <- crew_df %>%
count(pilot, guide, name = "flights")
ggplot(crew_heatmap, aes(x = factor(pilot), y = factor(guide), fill = flights)) +
geom_tile(color = "white") +
scale_fill_gradient(low = "white", high = "darkblue") +
labs(title = "Liczba wspólnych lotów: Pilot vs Przewodnik",
x = "ID Przewodnika",
y = "ID Pilota",
fill = "Liczba lotów") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 15. Heatmapa wspólnych wyjazdów wybranych członków załogi"
crew_query <- "WITH pilot_names AS (SELECT id_employee, CONCAT(first_name, ' ', last_name) AS pilot_name FROM employee
WHERE id_employee IN (SELECT DISTINCT id_pilot FROM spaceflight)),
guide_names AS (SELECT id_employee, CONCAT(first_name, ' ', last_name) AS guide_name FROM employee
WHERE id_employee IN (SELECT DISTINCT id_guide FROM spaceflight))
SELECT e1.pilot_name AS pilot, e2.guide_name AS guide FROM spaceflight
INNER JOIN pilot_names AS e1 ON spaceflight.id_pilot = e1.id_employee
INNER JOIN guide_names AS e2 ON spaceflight.id_guide = e2.id_employee"
crew_df <- dbGetQuery(con, crew_query)
crew_heatmap <- crew_df %>%
count(pilot, guide, name = "flights")
ggplot(crew_heatmap, aes(x = factor(pilot), y = factor(guide), fill = flights)) +
geom_tile(color = "white") +
scale_fill_gradient(low = "white", high = "darkblue") +
labs(title = "Liczba wspólnych lotów: Pilot vs Przewodnik",
x = "Imię przewodnika",
y = "Imię pilota",
fill = "Liczba lotów") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 15. Heatmapa wspólnych wyjazdów wybranych członków załogi"
crew_query <- "WITH pilot_names AS (SELECT id_employee, CONCAT(first_name, ' ', last_name) AS pilot_name FROM employee
WHERE id_employee IN (SELECT DISTINCT id_pilot FROM spaceflight)),
guide_names AS (SELECT id_employee, CONCAT(first_name, ' ', last_name) AS guide_name FROM employee
WHERE id_employee IN (SELECT DISTINCT id_guide FROM spaceflight))
SELECT e1.pilot_name AS pilot, e2.guide_name AS guide FROM spaceflight
INNER JOIN pilot_names AS e1 ON spaceflight.id_pilot = e1.id_employee
INNER JOIN guide_names AS e2 ON spaceflight.id_guide = e2.id_employee"
crew_df <- dbGetQuery(con, crew_query)
crew_heatmap <- crew_df %>%
count(pilot, guide, name = "flights")
ggplot(crew_heatmap, aes(x = factor(pilot), y = factor(guide), fill = flights)) +
geom_tile(color = "white") +
scale_fill_gradient(low = "white", high = "lightblue") +
labs(title = "Liczba wspólnych lotów: Pilot vs Przewodnik",
x = "Imię przewodnika",
y = "Imię pilota",
fill = "Liczba lotów") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
#| echo: false
#| warning: false
query_7 <- "WITH crews_with_max_flights AS (SELECT
CONCAT(e1.first_name, ' ', e1.last_name, ', ', e2.first_name, ' ', e2.last_name) AS imiona,
COUNT(*) AS liczba_wyjazdów
FROM spaceflight AS s
INNER JOIN employee AS e1 ON s.id_pilot = e1.id_employee
INNER JOIN employee AS e2 ON s.id_guide = e2.id_employee
GROUP BY s.id_pilot, s.id_guide
HAVING COUNT(*) = (
SELECT MAX(flight_count) FROM (
SELECT COUNT(*) AS flight_count
FROM spaceflight
GROUP BY id_pilot, id_guide
) AS sub
))
SELECT GROUP_CONCAT(imiona SEPARATOR ' oraz ') AS crews_with_max_flights_combined FROM crews_with_max_flights"
df7 <- dbGetQuery(con, query7)
#| echo: false
#| warning: false
#| fig.width: 6
#| fig.height: 6
#| fig.align: "center"
#| fig-cap: "Wykres 15. Heatmapa wspólnych wyjazdów wybranych członków załogi"
crew_query <- "WITH pilot_names AS (SELECT id_employee, CONCAT(first_name, ' ', last_name) AS pilot_name FROM employee
WHERE id_employee IN (SELECT DISTINCT id_pilot FROM spaceflight)),
guide_names AS (SELECT id_employee, CONCAT(first_name, ' ', last_name) AS guide_name FROM employee
WHERE id_employee IN (SELECT DISTINCT id_guide FROM spaceflight))
SELECT e1.pilot_name AS pilot, e2.guide_name AS guide FROM spaceflight
INNER JOIN pilot_names AS e1 ON spaceflight.id_pilot = e1.id_employee
INNER JOIN guide_names AS e2 ON spaceflight.id_guide = e2.id_employee"
crew_df <- dbGetQuery(con, crew_query)
crew_heatmap <- crew_df %>%
count(pilot, guide, name = "flights")
ggplot(crew_heatmap, aes(x = factor(pilot), y = factor(guide), fill = flights)) +
geom_tile(color = "white") +
scale_fill_gradient(low = "white", high = "lightblue") +
labs(title = "Liczba wspólnych lotów: pilot i przewodnik",
x = "Imię przewodnika",
y = "Imię pilota",
fill = "Liczba lotów") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
#| echo: false
#| warning: false
if (more_popular_force_side$liczba_klientów - less_popular_force_side$liczba_klientów < 10) {
str_5 <- "Możemy zaobserwować, że liczba klientów, którzy wybrali jasną oraz ciemną stronę mocy, nie różni się znacznie - obydwie strony mocy cieszą się podobnym zainteresowaniem. Oznacza to, że firma może rozwijać swoją ofertę, przygotowując kolejne propozycje wycieczek zarówno z jasną, jak i ciemną stroną mocy."
} else {
str_5 <- paste("Wobec większego zainteresowania klientów wyjazdami oznaczonymi jako ", more_popular_force_side$strona_mocy, " strona mocy, można wprowadzić do oferty firmy więcej wycieczek właśnie tego typu.")
}
